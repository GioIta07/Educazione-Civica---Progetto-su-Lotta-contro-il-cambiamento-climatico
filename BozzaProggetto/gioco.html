<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoCity - Eventi Climatici</title>
    <link rel="stylesheet" href="stylegioco.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="panel-left">
            <h1>üåç EcoCity</h1>
            <div class="timer" id="timer">‚è≥ Tempo: 30s</div>
            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">üìÖ Anno:</span>
                    <span class="stat-value" id="anno">1</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">‚ö° Energia:</span>
                    <span class="stat-value" id="energia">100</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üí∞ Economia:</span>
                    <span class="stat-value" id="economia">100</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üè≠ Inquinamento:</span>
                    <span class="stat-value" id="inquinamento">50</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üå°Ô∏è Temperatura:</span>
                    <span class="stat-value" id="temperatura">1.00 ¬∞C</span>
                </div>
            </div>
            <div class="buttons">
                <button class="btn-carbone" onclick="scelta('carbone')">üè≠ Carbone</button>
                <button class="btn-rinnovabili" onclick="scelta('rinnovabili')">‚òÄÔ∏è Rinnovabili</button>
                <button class="btn-nucleare" onclick="scelta('nucleare')">‚ò¢Ô∏è Nucleare</button>
                <button class="btn-nucleare" onclick="scelta('economia')">üí∞ Economia</button>
            </div>
            <div id="eventMessage"></div>
        </div>
        <div class="panel-right">
            <h2 style="margin-bottom: 20px; color: #555;">üìä Andamento Climatico</h2>
            <div class="chart-container">
                <canvas id="grafico"></canvas>
            </div>
        </div>
    </div>
    <script>
        // === STATO DEL GIOCO ===
        let anno = 1;
        const MAX_ANNI = 100;
        let energia = 10;
        let economia = 100;
        let inquinamento = 20;
        let temperatura = 1.0;
        let LOL = Math.floor(Math.random() * 40) + 1;
        let sviluppo = 1;
        let effettiNucleare = 0;
        let anniPassati = [];
        let storicoTemp = [];
        let storicoInq = [];
        let odionucleare= 0;
        let calmovento=0;
        // Timer
        const annoTime = 30;
        let timeRemaining = annoTime;
        let timerInterval;
        // === GRAFICO ===
        const ctx = document.getElementById('grafico').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Temperatura (¬∞C)',
                        data: [],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Inquinamento',
                        data: [],
                        borderColor: '#95a5a6',
                        backgroundColor: 'rgba(149, 165, 166, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        // === FUNZIONI ===
        function aggiornaUI() {
            document.getElementById('anno').textContent = anno;
            document.getElementById('energia').textContent = energia;
            document.getElementById('economia').textContent = economia;
            document.getElementById('inquinamento').textContent = inquinamento;
            document.getElementById('temperatura').textContent = temperatura.toFixed(2) + ' ¬∞C';
        }
        function aggiornaGrafico() {
            chart.data.labels = anniPassati;
            chart.data.datasets[0].data = storicoTemp;
            chart.data.datasets[1].data = storicoInq;
            chart.update();
        }
        function mostraEvento(messaggio) {
            const eventDiv = document.getElementById('eventMessage');
            eventDiv.innerHTML = `<div class="event-message">${messaggio}</div>`;
            setTimeout(() => {
                eventDiv.innerHTML = '';
            }, 5000);
        }
        function eventoClimatico() {
            const eventi = [];
            if (inquinamento < 20 && LOL === 9) {
                eventi.push({ nome: "üé™ Festival della luce", energia: -30, economia: +30, inquinamento: -0 });
            }
            if (inquinamento > 80 && LOL === 24) {
                eventi.push({ nome: "üò∑ Emergienza sanitaria", energia: -10, economia: -40, inquinamento: -0 });
            }
            if (inquinamento > 100 && LOL>21 && lol <=24) {
                eventi.push({ nome: "üò∑ Emergienza sanitaria", energia: -10, economia: -40, inquinamento: -0 });
            }
            if (LOL === 25 ) {
                eventi.push({ nome: " Basso vento ", energia: -0, economia: -0, inquinamento: -0, calmovento: +5 });
            }
            if (LOL === 26 ) {
                eventi.push({ nome: "üíµ Investitore ", energia: -30, economia: -30, inquinamento: -0 });
            }
            if (LOL === 27 ) {
                eventi.push({ nome: "üì∞ Referendum popolare ", energia: +0, economia: -0, inquinamento: -0, odionucleare:+5 });
            }
            if (LOL === 28 && tipo === 'rinnovabili') {
                eventi.push({ nome: "üí° Efficenza ", energia: +15, economia: -0, inquinamento: -0 });
            }
            if (LOL === 29) {
                eventi.push({ nome: "üõ†Ô∏è Guasto", energia: -50, economia: -20, inquinamento: +0 });
            }
            if (LOL === 39) {
                eventi.push({ nome: "üö∂‚Äç‚û°Ô∏èDomenica a piedi", energia: +10, economia: -20, inquinamento: -20 });
            }
            if (LOL === 35 && tipo === 'carbone') {
                eventi.push({ nome: "ü™ß Protesta", energia: -0, economia: -20, inquinamento: -0 });
            }
            if (LOL === 17) {
                eventi.push({ nome: "‚õèÔ∏è Mina di carbone", energia: -10, economia: +50, inquinamento: 15 });
            }
            if (LOL === 11) {
                eventi.push({ nome: "‚ùÑÔ∏è Ondata di gelo", energia: -30, economia: -25, inquinamento: 5 });
            }
            if (temperatura > 1.5 && LOL === 10) {
                eventi.push({ nome: "üî• Ondata di calore", energia: -30, economia: -25, inquinamento: 5 });
            }
            if (temperatura > 2.0 && LOL === 20) {
                eventi.push({ nome: "üåæ Siccit√†", energia: -20, economia: -25, inquinamento: 10 });
            }
            if (inquinamento > 80 && LOL === 30) {
                eventi.push({ nome: "üåä Alluvione", energia: -15, economia: -30, inquinamento: 5 });
            }
            if (inquinamento > 100 && LOL === 30) {
                eventi.push({ nome: "üåä Alluvione pesante", energia: -25, economia: -50, inquinamento: 15 });
            }
            if (temperatura > 2.5 && LOL === 40) {
                eventi.push({ nome: "‚ùÑÔ∏è Tempesta estrema", energia: -25, economia: -20, inquinamento: 5 });
            }
            if (eventi.length > 0 && Math.random() < 0.4) {
                const evento = eventi[Math.floor(Math.random() * eventi.length)];
                energia += evento.energia;
                economia += evento.economia;
                inquinamento += evento.inquinamento;
                mostraEvento(`‚ö†Ô∏è EVENTO:\n${evento.nome}`);
            }
        }
        function fineGioco(messaggio) {
            clearInterval(timerInterval);
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);
            mostraEvento(`<div class="game-over">${messaggio}</div>`);
        }
        function scelta(tipo) {
            if (effettiNucleare === 1 && tipo !== 'nucleare') {
                mostraEvento("‚ö†Ô∏è Devi cliccare Nucleare una seconda volta!");
                return;
            }
            if (tipo === 'carbone') {
                energia += 30;
                economia -= 20;
                inquinamento += 25;
            }else if (tipo === 'economia') {
                energia -= 30;
                economia += 50;
                inquinamento += 50;
            } else if (tipo === 'rinnovabili'&& calmovento=== 0) {
                energia += 15;
                economia -= 5;
                inquinamento -= 20;
            } else if (tipo === 'nucleare' && odionucleare === 0 ) {
                effettiNucleare++;
                
                if (Math.random() < 0.01) {
                    economia -= 9999999999999999;
                    inquinamento += 9999999999999;
                    mostraEvento("‚ò¢Ô∏è INCIDENTE NUCLEARE!");
                    effettiNucleare = 0;
                } else if (effettiNucleare === 1) {
                    mostraEvento("‚ö†Ô∏è Clicca Nucleare ancora una volta per attivarlo!");
                    return;
                }
            }
            if (effettiNucleare === 2) {
                energia += 30;
                economia += 5;
                inquinamento += 5;
                effettiNucleare = 0;
            }
            if (inquinamento < 0) inquinamento = 0;
            temperatura += inquinamento * 0.005;
            if (odionucleare>0) odionucleare=0;
            sviluppo++;
            eventoClimatico();
            anniPassati.push(anno);
            storicoTemp.push(temperatura);
            storicoInq.push(inquinamento);
            anno++;
            aggiornaUI();
            aggiornaGrafico();
            resetTimer();
            // Controlla condizioni di fine gioco
            if (temperatura >= 10) {
                fineGioco("üî• COLLASSO CLIMATICO<br>La citt√† non √® pi√π abitabile.");
            } else if (anno > MAX_ANNI) {
                fineGioco("üèÜ SIMULAZIONE COMPLETATA");
            } else if (economia < 0) {
                fineGioco("üí∏ NON HAI PI√ô UN'ECONOMIA");
            } else if (energia <= 0) {
                fineGioco("üí∏ NON HAI PI√ô ENERGIA");
            }else if (economia < 10 && temperatura >= 10 && lol=== 1) {
                fineGioco("üí∏ NON HAI PI√ô ENERGIA");
            }

        }
        function resetTimer() {
            timeRemaining = annoTime;
        }
        function aggiornaTimer() {
            timeRemaining--;
            document.getElementById('timer').textContent = `‚è≥ Tempo: ${timeRemaining}s`;
            if (timeRemaining <= 0) {
                economia -= 10;
                anniPassati.push(anno);
                storicoTemp.push(temperatura);
                storicoInq.push(inquinamento);
                anno++;
                aggiornaUI();
                aggiornaGrafico();
                resetTimer();
                mostraEvento("‚ö†Ô∏è Hai perso tempo! Economia -10");
                if (economia < 0) {
                    fineGioco("üí∏ NON HAI PI√ô UN'ECONOMIA");
                } else if (anno > MAX_ANNI) {
                    fineGioco("üèÜ SIMULAZIONE COMPLETATA");
                }
            }
        }
        // Avvia il gioco
        aggiornaUI();
        timerInterval = setInterval(aggiornaTimer, 1000);
    </script>
</body>
</html>